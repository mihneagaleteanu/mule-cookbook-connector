= Cookbook Connector User Guide
:keywords: anypoint studio, esb, connector, endpoint, cookbook
:imagesdir: ./_images
:toc: macro
:toclevels: 2

_Community_

*Release Notes:* link:/release-notes/cookbook-connector-release-notes[Cookbook Connector Release Notes]

== Contents

. link:#intro[Introduction]
. link:#prerequisites[Prerequisites]
. link:#requirements[Requirements]
    .. link:#dependencies[Dependencies]
. link:#namespace-and-schema[Namespace and Schema]
. link:#mavenized-app[Using the Connector in a Mavenized Mule App]
. link:#install-and-config[Installing & Configuring]
    .. link:#installing[Installing]
    .. link:#configuring[Configuring]
    .. link:#upgrading[Upgrading from an Older Version]
. link:#using-connector[Using this Connector]
  .. link:#cql-syntax[Cookbook Query Language (CQL) Syntax]
. link:#connection-pool[Managing the Connection Pool]
. link:#example[Example Use Case]
    .. link:#example-code[Example Use Case Code]
    .. link:#demos[Demos]
    .. link:#tips[Tips]
. link:#see-also[See Also]


[[intro]]
== Introduction

The Cookbook Connector provides integration to Mule's Cookbook API. It is an open source connector meant to serve as a starting point to learn the features of DevKit for building your own connector. It is part of the link:http://mulesoft.github.io/mule-cookbook-tutorial/[Mule Cookbook Tutorial].

The Cookbook API allows users to perform the Create, Read, Update, and Delete (CRUD) operations on single and multiple recipes and ingredients, as well as viewing recently added recipes. The API is exposed as a SOAP Service using a WSDL file, as a Rest API with a RAML file, and through a Java SDK.

This connector is maintained under the link:/mule-user-guide/v/3.7/anypoint-connectors#connector-categories[_Community_] support policy.


[[prerequisites]]
== Prerequisites

This document assumes that you are familiar with Mule, link:/mule-studio/v/3.8/anypoint-connectors[Anypoint Connectors], and link:/mule-fundamentals/v/3.8/anypoint-studio-essentials[Anypoint Studio Essentials]. To increase your familiarity with Studio, consider completing the link:/mule-fundamentals/v/3.8/basic-studio-tutorial[Basic Studio Tutorial]. Further, this page assumes that you have a basic understanding of link:/mule-fundamentals/v/3.8/elements-in-a-mule-flow[Mule Flows] and link:/mule-fundamentals/v/3.8/global-elements[Mule Global Elements].

To use the Cookbook connector, you must have the following:

* **Anypoint Studio:** if you don't use Anypoint Studio for development, follow the instructions to install the PeopleSoft Maven dependencies into your pom.xml file .
* **Cookbook Service:** you can install it locally or use the service endpoint exposed in CloudHub. For Authentication details, refer to http://mulesoft.github.io/mule-cookbook-tutorial/#_authentication[Cookbook Authentication] section.


[[requirements]]
== Requirements

For hardware and software requirements, please visit link:/mule-user-guide/v/3.8/hardware-and-software-requirements[Mule Hardware and Software Requirements] page.


[[dependencies]]
=== Dependencies

The connector requires the following dependencies:

[options="header,autowidth"]
|===
|Application/Service|Version
|Anypoint Studio|5.2 or higher
|Mule Runtime|3.6.x or higher
|Java|1.7 or higher
|Cookbook SDK|1.0.0
|===

[[namespace-and-schema]]
== Namespace and Schema

When designing your application in Studio, the act of dragging the connector from the palette onto the Anypoint Studio canvas should automatically populate the XML code with the connector *namespace* and *schema location*.

[TIP]
If you are manually coding the Mule application in Studio's XML editor or other text editor, paste these into the header of your *Configuration XML*, inside the `<mule>` tag.

[source, xml,linenums]
----
<mule xmlns:cookbook="http://www.mulesoft.org/schema/mule/cookbook"
  ...
  xsi:schemaLocation="http://www.mulesoft.org/schema/mule/cookbook 
                      http://www.mulesoft.org/schema/mule/cookbook/current/mule-cookbook.xsd">
  ...
  <flow name="yourFlow">
    ...
  </flow>
</mule>
----


[[mavenized-app]]
== Using the Connector in a Mavenized Mule App

If you are coding a Mavenized Mule application, this XML snippet must be included in your `pom.xml` file.

[source,xml,linenums]
----
<dependency>
  <groupId>org.mule.modules</groupId>
  <artifactId>mule-module-cookbook</artifactId>
  <version>1.0.0</version>
</dependency>
----

NOTE: The latest version of the Cookbook connector is 1.0.0.


[[install-and-config]]
== Installing and Configuring

The Cookbook connector is a sample connector developed to be useful as both learning tool and a skeleton connector. The connector will guide you to develop SDK based connector's using the features provided by Anypoint Devkit framework and should not be used in Production environments.


[[installing]]
=== Installing

To install Cookbook connector in Anypoint Studio, follow the steps below:

* Open Anypoint Studio and got to **Help -> Install New Software**.
* Select *Anypoint Connectors Update Site - http://repository.mulesoft.org/connectors/releases/3.5.0*.
* Locate the Cookbook Connector.

image:cookbook_install_updatesite.png["Anypoint Studio Install Window"]

* Click *Next* and accept the License Agreement.
* Restart Studio when prompted.
* Now, the Cookbook connector should appear in your Studio Palette: +

image:cookbook_install_palette.png["Anypoint Studio palette - Cookbook Connector"]

NOTE: Read more about link:/mule-user-guide/v/3.8/installing-connectors[Installing Connectors].


[[configuring]]
=== Configuring

To use the Cookbook connector in your Mule application, you must configure a global Cookbook element that can be used by all the Cookbook connectors in the application.

NOTE: Read more about link:/mule-fundamentals/v/3.8/global-elements[Mule Global Elements].

==== Setting up the Global Configuration

The connector supports the following authentication types:

* Custom with a username and password that provides a token to send with each request as part of the request.

* link:http://oauth.net/2/[OAuth 2.0] 

NOTE: For more information on OAuth and Mule, refer to link:https://docs.mulesoft.com/mule-user-guide/v/3.8/using-a-connector-to-access-an-oauth-api[Using a Connector to Access an OAuth API].

---
===== Studio Visual Editor
---

* Click the *Global Elements* tab at the base of the canvas.
* On the *Global Mule Configuration Elements* screen, click *Create*.
* In the *Choose Global Type* wizard, expand *Connector Configuration* and select one of the provided options:
  ** Cookbook: Configuration (basic authentication)
  ** Cookbook: OAuth 2.0 (OAuth 2.0 authentication)
* Click *Ok*.

image:cookbook_config_global_wizard.png["Global Element Configuration Wizard"]

* For **Cookbook: Configuration:** Configure the parameters according to instructions below.

image:cookbook_config_global.png["Global Element Configuration"]

[options="header,autowidth"]
|===
|Field|Description
|`Username`|The username to connect to the Cookbook instance.
|`Password`|The password to connect to the Cookbook instance.
|`Address`| The SOAP endpoint of your local cookbook service or use the default to connect to the cloudhub instance.
|===

* For **Cookbook: OAuth 2.0:** Configure the parameters according to instructions below.

image:cookbook_oauth_global.png["Global Element Configuration"]

[options="header,autowidth"]
|===
|Field|Description| Example
3+|*General Tab*
|`Consumer Key`|The consumer key to connect to the Cookbook instance.|
|`Consumer Secret`|The consumer secret to connect to the Cookbook instance.|
3+|*Oauth Tab*
|`Domain`| The domain for returning call after OAuth dance.| **localhost**
|`Local Port`| The port for the callback.| **8081**
|`Remort Port`| The port for the callback.| **8081**
|`Path`| The path for the call back.| **callback**
|===

* Keep the *Pooling Profile* and the *Reconnection  tabs* with their default values.
* Click *Test Connection* (not available for OAuth) to confirm that the parameters of your global configuration are correct and that Mule is able to connect to your Cookbook instance.

NOTE: Read more about link:/mule-user-guide/v/3.8/testing-connections[Testing Connections].

* Click *OK* to save the global connector configurations.

---
===== Studio XML Editor
---

* Ensure you have included the **Cookbook namespace** in your configuration file.

[source,xml,linenums]
----
<mule xmlns:cookbook="http://www.mulesoft.org/schema/mule/cookbook" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:spring="http://www.springframework.org/schema/beans" version="EE-3.6.2"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-current.xsd
http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/cookbook http://www.mulesoft.org/schema/mule/cookbook/current/mule-cookbook.xsd">
    <!-- use the following global configuration code to create the cookbook config -->

    <cookbook:config name="Cookbook__Configuration" username="${mule.cookbook.username}" password="${mule.cookbook.password}" doc:name="Cookbook: Configuration"/>

    <!-- here go your flow elements -->
</mule>
----

* Save the changes made to the XML file.


[[upgrading]]
=== Upgrading From an Older Version

If you’re currently using an older version of the connector, a small pop-up appears in the bottom right corner of Anypoint Studio with an *"Updates Available"* message.

. Click the pop-up and check for available updates. 
. Click the Connector version checkbox and click *Next* and follow the instructions provided by the user interface. 
. *Restart* Studio when prompted. 
. After restarting, when creating a flow and using the Cookbook Connector, if you have several versions of the connector installed, you may be asked which version you would like to use. Choose the one you would like to use.

[NOTE]
We recommend that you keep Studio up to date with its latest version. 


[[using-connector]]
== Using this Connector

The Cookbook is an operation-based coonector, which means that, when you add the connector to your flow, you need to configure a specific operation it is intended to perform.

The connector supports the following operations:

==== Message Processors

[cols="30%,70%"]
|===
|*Create*| Creates a new entity.
|*Create multiple*| Creates a list of entities.
|*Delete*| Deletes an entitiy given its ID.
|*Delete multiple*| Deletes a list of entities given their IDs.
|*Describe*| Retrieves the complete list of fields and data types (metadata) of a Ingredient or Recipe object.
|*Get*| Retrieves an existing entity given its ID.
|*Get multiple*| Retrieves a list of entities given a list of their IDs.
|*Get recently added recipes*| Retrieves a list of the last created Recipes.
|*Query*| Executes a query call to the Cookbook service and fetches all entities that matches the specidied criteria. The query string must comply with the  link:/mule-user-guide/v/3.8/cookbook-connector#cql-syntax[CQL syntax].
|*Update*| Modifies the fields of a given entity.
|*Update multiple*| Modifies the fields of a given list of entities.
|===

NOTE: Entity = Ingredient or Recipe.

NOTE: When OAuth 2.0 is used, two additional operations will automatically appear in the operations list: Authorize and Unauthorize.

==== Message Sources

[cols="30%,70%"]
|===
|*Get recently added recipes*| The connector acts as an inbound endpoint, polling the Cookbook service to retrieve any new entity. 
|===

==== Transformers

[cols="30%,70%"]
|===
|*Entity to Map*| Converts a Ingredient or Recipe to a simple key-value Map.
|===

=== Adding to a Flow

* Create a new *Mule Project* in Anypoint Studio.
* Add a suitable Mule *Inbound Endpoint*, such as the HTTP listener or File endpoint, to begin the flow.
* Drag & drop the *Cookbook Connector* onto the canvas.
* Click on the connector component to open the *Properties Editor*.
+
image:cookbook_usecase_settings.png[Flow Settings]
* Configure the following parameters:
+
[options="header",cols="30%,70%"]
|===
|Field|Description
|Display Name|Label to identity the connector component in the application.
|Connector Configuration|Select the global element configuration created in previous steps. Global elements encapsulate reusable data about the connection to the target resource or service.
|Operation|Select one of the listed options from the drop-down menu.
|Type|Select the type of the entity you want to work with. If you have provided the credentials earlier, the connector would automatically fetch the metadata.
|Entity Reference or ID (depending on the selected operation)|Provide the reference (MEL expression) to the entity object to be created. Default value is `#[payload]`.
|===

* Save your configurations.

[[cql-syntax]]
=== CQL (Cookbook Query Language Syntax) 

The Cookbook Connector supports query functionality. If you wish to execute a native query directly to the Cookbook service, you should know that a CQL query contains the following components:

[cols="30%,70%"]
|===
|*GET*|Similar to the `SELECT` clause in SQL or MySQL syntax.
|*FROM* |Only options are "INGREDIENT" and "RECIPE".
|*MATCHING* | Similar to the `WHERE` condition.
|===

```
GET 
  [ALL | field1, field2, fieldN]

FROM
  [INGREDIENT | RECIPE]

MATCHING 
  [condition]

```

==== Valid fields (for GET selector)

```
id
created
lastModified
name
quantity
unit
prepTime
cookTime
ingredients
```

==== Valid operators (for MATCHING clause)

```
==
<>
>
<
>=
<=
contains
```

==== Query examples


```
GET ALL FROM INGREDIENT

GET ALL FROM RECIPE

GET id FROM RECIPE

GET id,created,lastModified,name,quantity,unit FROM RECIPE

GET name FROM INGREDIENT MATCHING id==1

GET ALL FROM RECIPE MATCHING id contains 1
```



[[connection-pool]]
== Managing the Connection Pool

To define the pooling profile for the connector manually, access the *Pooling Profile* tab in the applicable global element for the connector.

For background information on pooling, see link:/mule-user-guide/v/3.8/tuning-performance[Tuning Performance].


[[example]]
== Example Use Case

As already mentioned, the Cookbook Connector is an operation-based connector that allows you to invoke web service operations exposed by the Cookbook API.

The most common use case scenarios  for the Cookbook connector are listed below:

* Single CRUD operations: Create, Get, Update, and Delete a recipe or an ingredient from the repository.

* Multiple CRUD operations: Create, Get, Update, and Delete a list of recipes or ingredients in one call.

* Get recently added recipes: both as inbound and as outbound endpoint.

=== Update Use Case
Update the *quantity* and *unit type* of an existing Ingredient. 

image:ck_example_flow.png[Example Update Flow]

=== Anypoint Studio Visual Editor | XML Editor

1. Create a new *Mule Project* in Anypoint Studio.

2. Edit the `mule-app.properties` file placed under `src\main\app` folder to set the Cookbook credentials.
+
```
cookbook.username=<USERNAME>
cookbook.password=<PASSWORD>
```

3. Drag a *HTTP endpoint* into the canvas and configure the following parameters:
+
[options="header,autowidth"]
|===
|Parameter|Value
|Display Name|HTTP
|Connector Configuration| If no HTTP element has been created yet, click the plus sign to add a new *HTTP Listener Configuration* and click *OK* (leave the values to its defaults).
|Path|/update
|Username|`${cookbook.username}`
|Password|`${cookbook.password}`
|===
+
TIP: Username and Password use property **placeholder syntax** to load the credentials in a more simple and reusable way. Read more about this practice at link:/mule-user-guide/v/3.8/configuring-properties[Configuring Properties].

4. Drag a *Cookbook connector* next to the HTTP and configure it according to the steps below:
+
[options="header,autowidth"]
|===
|Parameter|Value
|Display Name|Get (or any other name you prefer).
|Connector Configuration|`Cookbook__Configuration` (the reference name to the global element you have previously created).
|Operation|`Get`
|Type|`Ingredient`
|Id|`2`
|===
+
The XML should look similar to this snippet:
+
```xml
<!-- Config -->
<cookbook:config name="Cookbook__Configuration" username="${cookbook.username}" password="${cookbook.password}" doc:name="Cookbook: Configuration"/>

<!-- Endpoint (GET) -->
<cookbook:get config-ref="Cookbook__Configuration" type="Ingredient" id="2" doc:name="Get"/>
```

5. Add a *Object to JSON* transformer.

6. Add a *Logger* to display the details of the retrieved entity in the Studio Console. The following configuration is advised:
+
[options="header,autowidth"]
|===
|Parameter|Value
|Display Name|ngredient details
|Message|`#[payload]` (the output from the connector)
|Level|INFO
|===

7. Add a *Transform Message* component (DataWeave). By the agility of DataSense, you are presented with a list of possible fields to use, as available to your Cookbook instance.
+
```xml
%dw 1.0
%output application/java
---
{
  id: payload.id,
  name: payload.name,
  quantity: 118.0,
  unit: "MILLIGRAMS"
}
```
+
image:ck_example_dw.png[DataWeave]

8. Place another *Cookbook connector* next to the DataWeave element and configure as follows:
+
[options="header,autowidth"]
|===
|Parameter|Value
|Display Name|Update (or any other name you prefer).
|Connector Configuration|`Cookbook__Configuration` (the reference name to the global element you have previously created).
|Operation|`Update`
|Type|`Ingredient`
|Entity Reference|`#[payload]`
|===
+
The XML should look similar to this snippet:
+
```xml
<!-- Endpoint (UPDATE) -->
<cookbook:update config-ref="Cookbook__Configuration" type="Ingredient" entity-ref="#[payload]" doc:name="Update"/>
```

9. Add a *Logger* to display the details of the updated entity in the Studio Console. The following configuration is advised:
+
[options="header,autowidth"]
|===
|Parameter|Value
|Display Name|Ingredient details
|Message|`#[payload]` (the output from the connector)
|Level|INFO
|===

10. Add a *Object to JSON* transformer to display the response in the browser.
+
NOTE: You can use any trasformer you want, such as *Object to XML*, for example.

11. Add a *Logger* scope after the transformer to print the data that is being passed by the Cookbook connector in the Mule Console. Configure the Logger according to the table below.

12. *Save* the changes and *run* the project as a Mule Application.
13. *Open* a web browser and hit the URL `*http://localhost:8081/update*`. You should see the complete information of the modified Ingredient in JSON format:
+
image:ck_example_result.png[Example Update Flow]


[[example-code]]
=== Example Use Case Code

```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:dw="http://www.mulesoft.org/schema/mule/ee/dw" 
      xmlns:json="http://www.mulesoft.org/schema/mule/json"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns:cookbook="http://www.mulesoft.org/schema/mule/cookbook"
      xmlns="http://www.mulesoft.org/schema/mule/core"
      xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
      xmlns:spring="http://www.springframework.org/schema/beans" 
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/beans 
                          http://www.springframework.org/schema/beans/spring-beans-current.xsd
                          http://www.mulesoft.org/schema/mule/core
                          http://www.mulesoft.org/schema/mule/core/current/mule.xsd
                          http://www.mulesoft.org/schema/mule/cookbook
                          http://www.mulesoft.org/schema/mule/cookbook/current/mule-cookbook.xsd
                          http://www.mulesoft.org/schema/mule/http
                          http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
                          http://www.mulesoft.org/schema/mule/ee/dw
                          http://www.mulesoft.org/schema/mule/ee/dw/current/dw.xsd
                          http://www.mulesoft.org/schema/mule/json
                          http://www.mulesoft.org/schema/mule/json/current/mule-json.xsd">
    <!-- Configs -->
    <cookbook:config name="Cookbook__Configuration" 
      username="${cookbook.username}" password="${cookbook.password}" doc:name="Cookbook: Configuration"/>
    <http:listener-config name="HTTP_Listener_Configuration" host="0.0.0.0" port="8081" 
      doc:name="HTTP Listener Configuration"/>
    <!-- Flow -->
    <flow name="Update_Ingredient_Flow">
        <http:listener config-ref="HTTP_Listener_Configuration" path="/update" doc:name="HTTP"/>
        <cookbook:get config-ref="Cookbook__Configuration" type="Ingredient" id="2" doc:name="Get"/>
        <json:object-to-json-transformer doc:name="Object to JSON"/>
        <logger message="Current ingredient: #[payload]" level="INFO" doc:name="Logger"/>
        <dw:transform-message doc:name="Modify fields">
            <dw:set-payload><![CDATA[%dw 1.0
              %output application/java
              ---
              {
                id: payload.id,
                name: payload.name,
                quantity: 118.0,
                unit: "MILLIGRAMS"
              }]]></dw:set-payload>
        </dw:transform-message>
        <cookbook:update config-ref="Cookbook__Configuration" type="Ingredient" entity-ref="#[payload]" doc:name="Update"/>
        <json:object-to-json-transformer doc:name="Object to JSON"/>
        <logger message="Updated ingredient: #[payload]" level="INFO" doc:name="Logger"/>
    </flow>
</mule>

```

[[demos]]
=== Demos

You can download fully working examples from http://mulesoft.github.io/cookbook-connector/[here]


[[tips]]
=== Tips

==== Test the Connection

Use the *Test Connection* feature in the Global Element Configuration to validate the connection to the Cookbook instance,

. Open the *Cookbook Global Element Configuration*.
. Click the *Test Connection* button. If any of the credentials or URL provided is invalid, you will get an error message.
+
image:ck_tips_testconnection_error.png[Test Connection Fail]
. Perform the necessary changes until you get a success message:
image:ck_tips_testconnection_ok.png[Test Connection Success]


[[see-also]]
=== See Also

* For additional technical information regarding Cookbook Connector and Devkit features, please visit our link:/anypoint-connector-devkit/v/3.8/devkit-tutorial[DevKit Tutorial]. This document is also known as the *Mule Cookbook Tutorial*, available link:http://mulesoft.github.io/mule-cookbook-tutorial/[here].
* Learn more about working with link:/mule-studio/v/3.8/anypoint-connectors[Anypoint Connectors].
* Learn how to use link:/mule-user-guide/v/3.8/transformers[ Transformers].
